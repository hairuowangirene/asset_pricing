---
title: "QF600 Asset Pricing Homework 1"
author: "Wang Hairuo"
date: '2022-09-12'
output:
  pdf_document:
    template: report.tex
    toc: yes
    toc_depth: 2
lang: en
subtitle: Efficient Frontier
titlepage: yes
titlepage-color: 6C3082
titlepage-text-color: FFFFFF
titlepage-rule-color: FFFFFF
titlepage-rule-height: 2
---


```{r, include = FALSE}
library(tidyverse)
library(ggplot2)
library(knitr)
library(readxl)
```

\newpage

# Part 1: Portfolio without Riskless Assets

## `Question 1`: Create a Table Showing the Mean Return and Standard Deviation of Return for the Ten Industry Portfolios

```{r, include = FALSE}
# import the data for industry portfolios
industry_df = read_excel('Industry_Portfolios.xlsx')
industry_df = industry_df %>% 
  select(!Date)
```

```{r, include = FALSE}
# compute the mean of return for each industry
mean_return = colMeans(industry_df)
```

```{r, include = FALSE}
# compute the covariance matrix for each industry
cov_matrix = cov(industry_df)
```

```{r, include=FALSE}
# compute the standard deviation of return for each industry
sd_return = sqrt(diag(cov_matrix))
```

```{r, echo = FALSE}
# perform the table of mean return and standard deviation of return for each industry
return_table = data.frame(mean_return, sd_return)
kable(return_table, caption = "Mean of Return and Standard Deviation of Return for Ten Industry Portfolios", col.names = c("Mean of Return", "Standard Deviation of Return"))
```

According to Table 1, which shows the mean of return and standard deviation of return for ten industry respectively. 

\newpage
## `Question 2`: Plot the minimum-variance frontier (without the riskless asset) generated by the ten industry portfolios, with expected (monthly) return on the vertical axis and standard deviation of (monthly) return on the horizontal axis. This plot should cover the range from 0% to 2% on the vertical axis, in increments of 0.1% (or less).

```{r, include = FALSE}
# mean 
mean_return = colMeans(industry_df)
# covariance matrix
cov_matrix = cov(industry_df)
#inverse covariance matrix
inv_cov_matrix = solve(cov_matrix)
# number of industry portfolios
n = ncol(industry_df)
# unit vector
e_vector = as.vector(rep(x = 1,times = n))
```

```{r, include = FALSE}
# alpha 
alpha = t(mean_return) %*% inv_cov_matrix %*% e_vector
# zeta 
zeta = t(mean_return) %*% inv_cov_matrix %*% mean_return
# delta
delta = t(e_vector) %*% inv_cov_matrix %*% e_vector
```

```{r, include = FALSE}
# return for portfolio
return_p = seq(0, 2, by = 0.05) # 0.1% or less
# mean return for global minimum-variance portfolio
return_mv = alpha / delta
# volatility for portfolio
sigma_p = sqrt((1 / as.numeric(delta)) + (as.numeric(delta) / (as.numeric(zeta) * as.numeric(delta) - as.numeric(alpha) ^ 2)) * (return_p - as.numeric(return_mv)) ^ 2)

plot_df = data.frame(return_p, sigma_p)
```

```{r, echo = FALSE}
# plot the minimum-variance frontier without riskless asset
plot_df %>% 
  ggplot(aes(x = sigma_p, y = return_p, color = "red")) + 
  geom_path() + 
  theme_minimal() + 
  labs(caption = str_c("Figure 1: Minimum-Variance Frontier without Riskless Asset"), 
       x = 'volatility of return for portfolios', 
       y = 'return of portfolio') + 
  theme(legend.position = 'None')
```

According to Figure 1, which shows the minimum-variance frontier without riskless asset generated by ten industry portfolios. 

## `Question 3`: Briefly explain the economic significance and relevance of the minimum-variance frontier to an investor.

Each portfolio on the minimum-variance frontier is computed as the minimize the standard deviation of return by Lagrange multipliers for the different given portfolio return. Therefore, the minimum-variance frontier consists the portfolio with **the lowest risk (standard deviation of return)** in the opportunity set, for the given various portfolio return. 

For the investors who are risk averse, they would prefer higher return and lower risk, which also known as standard deviation of return. According to the minimum-variance frontier, the investor could figure out the frontier portfolio **with the lowest risk under their expected return of portfolio.** Moreover, investors could select the global minimum-variance portfolio with **minimum risk in the opportunity set** at the global minimum point on the minimum-variance frontier. Furthermore, the investor would not like to hold the portfolio which has return and volatility of return **on the right of the minimum-variance frontier** because the portfolio has higher risk under the same expected return compare with the frontier portfolio. Overall, the minimum-variance frontier could assist the investor to allocate their asset with lower risk for the given expected rerturn of portfolio and evaluate their portfolio 


# Part 2: Portfolio with Riskless Assets (risk-free rate is 0.13% per month)

## `Question 1`: Plot the efficient frontier (with the riskless asset) on the same plot as the minimum-variance frontier generated by the ten industry portfolios.

```{r, include=FALSE}
# compute the various expectation return for portfolio with riskless asset
return_p_wra = seq(0.13, 2.13, 0.05)
# risk-free rate
return_f = 0.13 # risk-free rate = 0.13%
# compute the volatility of return for portfolio with riskless asset
sigma_p_wra = sqrt(((return_p_wra - return_f) ^ 2) 
               / (as.numeric(zeta) -
                    2*as.numeric(alpha)*return_f + as.numeric(delta) * return_f ^ 2))
# record the return and volatility of return for portfolio in dataframe
plot_df = data.frame(return_p, sigma_p, return_p_wra, sigma_p_wra)
```


```{r, echo = FALSE}
# plot the efficient frontier with riskless asset on the figure of minimum-variance frontier above
plot_df %>% 
  ggplot(aes(x = sigma_p_wra)) + 
  geom_path(aes(y = return_p_wra, color = 'with riskless asset')) + 
  geom_path(aes(x = sigma_p, y = return_p, color = 'without riskless asset')) + theme_minimal() + 
  labs(caption = str_c('Figure 2. Minimum-Variance Frontier without Riskless Asset \n v.s Efficient Frontier with Riskless Asset'), 
       x = "volatility of return for portfolios", 
       y = "return of portfolios") + 
  theme(legend.title = element_blank())
```
According to Figure 2 above, which shows the efficient frontier with risk less asset generated by ten industry portfolios and the minimum-variance frontier without risk less asset respectively. We could see that there is an intersection point which represent the tengency portfolio that we are going to discuss in the next part. 

The efficient frontier of the portfolio with risk less asset shows that the mean return and volatility of return for the affine combination of risky portfolio and the riskless asset with risk-free rate of 0.13%.

## `Question 2`: Briefly explain the economic significance and relevance of the efficient frontier to an investor.

As we discussed the minimum-variance frontier above, and curve that lies above and to the right of the global minimum-variance portfolio is the efficient frontier. The efficient frontier consist with the portfolio with **largest return with the given volatility of return for the portfolio.** As the curve lies below the global minimum-variance portfolio would have lower return under the same volatility of return, then the below curve would not be efficient. The efficient in this case of portfolio with riskless asset, the efficient frontier for the portfolio is a straight line and that is also known as capital allocation line (CAL) for **the tangency portfolio**. The capital allocation line would show the mean return and volatility of return for **different affine combinations of risky portfolio and riskless asset.**

For the efficient frontier generated by 10 risky assets, the investors could figure out the efficient portfolio with **the largest expected return with the risk that they would like to tolerance**. Moreover, the investor could understand the relationship between the return and volatility of return for their portfolio and compare with the other portfolio for their asset allocation. On the other hand, the efficent frontier generated by combining risky portfolio and riskless asset, which also known as captial allocation line, could help the investor to figure out the **tangency portfolio**. Overall, the capital allocation line could indicate the weight for risk-free asset and risky asset in the tangency portfolio to the investor during the asset allocation. 



# Part 3: The Tangency Portfolio

## `Question 1`: Calculate the Sharpe ratio for the tangency portfolio, and also the tangency portfolio weights for the ten industry portfolios.

```{r, echo = FALSE}
# mean return for global minimum-variance portfolio
return_mv = alpha / delta
# risk-free rate = 0.13
return_f = 0.13
# compute the mean return for tangency portfolio
return_tg = (alpha * return_f - zeta) / (delta * return_f - alpha)
```

```{r, echo = FALSE}
# Compute volatility of return for tangency portfolio
sigma_tg = - ((zeta - 2 * alpha * return_f + delta * return_f ^ 2) ^ (1/2)) / (delta * (return_f - return_mv))
# excess return
return_sr = return_tg - return_f
# compute the Sharpe ratio for tangency portfolio
sharpe_tg = return_sr / sigma_tg
```



$$ Sharpe Ratio_{tg}= \frac{E[R_{tg} - R_f]}{\sigma_{tg}}$$

The Sharpe ratio represents the excess return for each unit of risk for the portfolio. Thus, we could see the formula of Sharpe Ratio of tangency portfolio, where $R_{tg}$ represents the return for the tangency portfolio and the $R_f$ represents the risk-free return (benchmark), and $\sigma_{tg}$ represents the volatility of portfolio excess return. 

As we known, the risk free rate is 0.13%. As well, the mean return for tangency portfolio could be computed by risk free rate, the scalars $\alpha, \zeta, \text{and } \delta$ by the formula below. 

$$
R_{tg} = \frac{\zeta - \alpha R_p}{\zeta \delta - \alpha ^ 2}
$$

The mean return for tangency portfolio is `r return_tg`. 

Moreover, the volatility of return for tangency portfolio could be computed by risk free rate, scalars $\alpha, \zeta \text{and } \delta$ by the formula below. 

$$
\sigma_{tg} = - \frac{(\zeta - 2\alpha R_f + \delta R_f ^2)^{\frac{1}{2}}} {\delta(R_f - R_{mv})}
$$

The volatility of return for tangency portfolio is `r sigma_tg`. 

Therefore, we could compute the Sharpe ratio for the tangency portfolio by the formula above, and **the Sharpe ratio for the tangency portfolio in this case is `r sharpe_tg`.** 

```{r, echo = FALSE}
# compute the intercept for weight of tangency portfolio
a = ((as.numeric(zeta) * inv_cov_matrix %*% e_vector) - (as.numeric(alpha) * inv_cov_matrix %*% mean_return)) / as.numeric(zeta * delta - alpha ^ 2)
# compute the slope for weight of tangency portfolio
b = (as.numeric(delta) * inv_cov_matrix %*% mean_return - as.numeric(alpha) * inv_cov_matrix %*% e_vector) /as.numeric(zeta * delta - alpha ^ 2)
# compute the weights for tangency portfolio
weight_tg = a + b %*% return_tg
weight_df = data.frame(weight_tg)
kable(weight_df, caption = "The Tangency Portfolio Weights for Ten Industry Portfolios", 
      col.names = "Tangency Portfolio Weights")
```

According to Table 2, which shows the tangency portfolio weights for each industry. The positive weight means normal investment or long position and the negative weight means short-sellings or short position. 


## `Question 2`: Briefly explain the economic significance and relevance of the tangency portfolio to an investor.

The tangency portfolio is the portfolio which tangent point with capital allocation line and efficient frontier generated by 10 risky assets. Moreover, the tangency portfolio have the **largest Sharpe ratio** out of all risky portfolios on the efficient frontier, which demonstrate that the tangency portfolio have the **largest excess return for each unit of total risk.**

As the tengency portfolio have the largest Sharpe ratio within the possible portfolio on the efficient frontier, therefore the risk averse investors prefer to hold the tangency portfolio because it have the largest reward-worth ratio. The tangency portfolio is the **optimal risky asset portoflio** for risk averse investors to hold for asset asset. 


\newpage

# Appendix

## `Part 1 - Question 1 Code`

```{r, results = 'hide'}
library(tidyverse)
library(ggplot2)
library(knitr)
library(readxl)
```

```{r, results='hide'}
# import the data for industry portfolios
industry_df = read_excel('Industry_Portfolios.xlsx')
# remove the column of date that is useless
industry_df = industry_df %>% 
  select(!Date)
```

```{r, results='hide'}
# compute the mean return for each industry portfolio
mean_return = colMeans(industry_df)
```

```{r, results='hide'}
# compute the covariance matrix for each industry portfolio
cov_matrix = cov(industry_df)
```

```{r, results='hide'}
# compute the standard deviation of return for each industry portfolio
sd_return = sqrt(diag(cov_matrix))
```

```{r, results='hide'}
# perform the table of mean return and standard deviation of return for each industry
return_table = data.frame(mean_return, sd_return)
kable(return_table, caption = "Mean of Return and Standard Deviation of Return for Ten Industry Portfolios", col.names = c("Mean of Return", "Standard Deviation of Return"))
```


## `Part 1 - Question 2 Code`

```{r, results='hide'}
# mean 
mean_return = colMeans(industry_df)
# covariance matrix
cov_matrix = cov(industry_df)
#inverse covariance matrix
inv_cov_matrix = solve(cov_matrix)
# number of industry portfolios
n = ncol(industry_df)
# unit vector
e_vector = as.vector(rep(x = 1,times = n))
```


```{r, results='hide'}
# alpha 
alpha = t(mean_return) %*% inv_cov_matrix %*% e_vector
# zeta 
zeta = t(mean_return) %*% inv_cov_matrix %*% mean_return
# delta
delta = t(e_vector) %*% inv_cov_matrix %*% e_vector
```

```{r, results='hide'}
# return for portfolio
return_p = seq(0, 2, by = 0.05) # 0.1% or less
# mean return for global minimum-variance portfolio
return_mv = alpha / delta
# volatility for portfolio
sigma_p = sqrt((1 / as.numeric(delta)) + (as.numeric(delta) / (as.numeric(zeta) * as.numeric(delta) - as.numeric(alpha) ^ 2)) * (return_p - as.numeric(return_mv)) ^ 2)

plot_df = data.frame(return_p, sigma_p)
```

```{r, fig.show='hide'}
# plot the minimum-variance frontier without riskless asset
plot_df %>% 
  # volatility of return as x, and return as y, the color of line is red
  ggplot(aes(x = sigma_p, y = return_p, color = "red")) + 
  # draw the frontier curve
  geom_path() + 
  # use the minimal theme for the plot
  theme_minimal() + 
  # add the title for the plot
  labs(caption = str_c("Figure 1: Minimum-Variance Frontier without Riskless Asset"), 
       # add the x label for the plot
       x = 'volatility of return for portfolios', 
       # add the y label for the plot
       y = 'return of portfolio') + 
  # remove the legend
  theme(legend.position = 'None')
```

## `Part 2 - Question 1 Code`

```{r, results = 'hide'}
# compute the various expectation return for portfolio with riskless asset
return_p_wra = seq(0.13, 2.13, 0.05)
# risk-free rate
return_f = 0.13 # risk-free rate = 0.13%
# compute the volatility of return for portfolio with riskless asset
sigma_p_wra = sqrt(((return_p_wra - return_f) ^ 2) 
               / (as.numeric(zeta) -
                    2*as.numeric(alpha)*return_f + as.numeric(delta) * return_f ^ 2))
# record the return and volatility of return for portfolio in dataframe
plot_df = data.frame(return_p, sigma_p, return_p_wra, sigma_p_wra)
```


```{r, fig.show='hide'}
# plot the efficient frontier with riskless asset on the figure of minimum-variance frontier above
plot_df %>% 
  # volatility of return for portfolio with riskless asset as x
  ggplot(aes(x = sigma_p_wra)) + 
  # draw the frontier for portfolio with riskless asset and return as y
  geom_path(aes(y = return_p_wra, color = 'with riskless asset')) + 
  # draw the frontier for portfolio without riskless asset and risk as x, return as y
  geom_path(aes(x = sigma_p, y = return_p, color = 'without riskless asset')) + 
  # use minimal theme for the plot
  theme_minimal() + 
  # add title for the plot
  labs(caption = str_c('Figure 2. Minimum-Variance Frontier without Riskless Asset \n v.s Efficient Frontier with Riskless Asset'), 
       # add x label for the plot
       x = "volatility of return for portfolios", 
       # add y label for the plot
       y = "return of portfolios") + 
  # remove the title for legend
  theme(legend.title = element_blank())
```

## `Part 3 - Question 1 Code`

```{r, results = 'hide'}
# mean return for global minimum-variance portfolio
return_mv = alpha / delta
# risk-free rate = 0.13 as given
return_f = 0.13
# compute the mean return for tangency portfolio
return_tg = (alpha * return_f - zeta) / (delta * return_f - alpha)
```

```{r, results = 'hide'}
# Compute volatility of return for tangency portfolio
sigma_tg = - ((zeta - 2 * alpha * return_f + delta * return_f ^ 2) ^ (1/2)) / (delta * (return_f - return_mv))
# excess return
return_sr = return_tg - return_f
# compute the Sharpe ratio for tangency portfolio
sharpe_tg = return_sr / sigma_tg
```

```{r, results = 'hide'}
# compute the intercept for weight of tangency portfolio
a = ((as.numeric(zeta) * inv_cov_matrix %*% e_vector) - (as.numeric(alpha) * inv_cov_matrix %*% mean_return)) / as.numeric(zeta * delta - alpha ^ 2)
# compute the slope for weight of tangency portfolio
b = (as.numeric(delta) * inv_cov_matrix %*% mean_return - as.numeric(alpha) * inv_cov_matrix %*% e_vector) /as.numeric(zeta * delta - alpha ^ 2)
# compute the weights for tangency portfolio
weight_tg = a + b %*% return_tg
weight_df = data.frame(weight_tg)
# perform the tangency portfolio weights in the table
kable(weight_df, caption = "The Tangency Portfolio Weights for Ten Industry Portfolios", 
      col.names = "Tangency Portfolio Weights")
```

